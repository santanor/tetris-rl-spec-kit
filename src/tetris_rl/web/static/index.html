<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tetris RL Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
  <header>
    <h1>Tetris RL</h1>
    <div class="header-controls inline">
      <button id="startBtn">Start</button>
      <div class="ctrl"><span>Episodes</span><input id="episodesInput" type="number" value="5" min="1" max="500"/></div>
  <div class="ctrl"><span>Broadcast</span><input id="broadcastEveryInput" type="number" value="1" min="1" max="500"/></div>
    </div>
  </header>
  <main>
    <!-- Board Panel -->
    <section class="panel board-panel">
      <div class="panel-title">Board</div>
      <div class="board-wrap vertical">
        <pre id="board"></pre>
        <div id="colorBoard" class="color-board" aria-label="Color Board" role="img"></div>
      </div>
    </section>
    <!-- Stats Panel -->
    <section class="panel stats-panel">
      <div class="panel-title">Stats</div>
      <div class="stats-grid">
        <div><span class="s-label">Episode</span><span id="statEpisode">-</span></div>
        <div><span class="s-label">Global</span><span id="statGlobalStep">-</span></div>
        <div><span class="s-label">Reward</span><span id="statReward">-</span></div>
        <div><span class="s-label">Loss</span><span id="statLoss">-</span></div>
        <div><span class="s-label">Epsilon</span><span id="statEpsilon">-</span></div>
        <div><span class="s-label">Lines</span><span id="statLines">-</span></div>
        <div><span class="s-label">ΔLines</span><span id="statLinesDelta">-</span></div>
      </div>
      <div class="heights-block">
        <div class="sub-title">Heights</div>
        <div id="heightsBar" class="heights-bar"></div>
        <div id="imbalanceInfo" class="heights-meta"></div>
      </div>
      <div class="recent-block">
        <div class="sub-title">Recent Episodes</div>
        <ul id="recentEpisodes" class="recent-episodes"></ul>
      </div>
    </section>
    <!-- Charts / Observability Panel -->
    <section class="panel charts-panel">
      <div class="panel-title">Observability</div>
      <div class="charts-grid">
        <div class="chart-card"><div class="chart-title">Episode Reward (last 200)</div><canvas id="rewardChart"></canvas></div>
        <div class="chart-card"><div class="chart-title">Loss (EMA + raw)</div><canvas id="lossChart"></canvas></div>
        <div class="chart-card"><div class="chart-title">Lines per Episode</div><canvas id="linesChart"></canvas></div>
  <div class="chart-card small"><div class="chart-title">Minimal Reward (latest)</div><canvas id="componentsChart"></canvas></div>
        <div class="chart-card small"><div class="chart-title">Action Distribution</div><canvas id="actionChart"></canvas></div>
        <div class="chart-card wide" id="networkCard">
          <div class="chart-title" style="display:flex;justify-content:space-between;align-items:center;gap:.5rem;">
            <span>Policy Network (State → Q-values)</span>
            <div class="net-controls"><button type="button" id="freezeNetBtn" class="mini-btn">Freeze</button></div>
          </div>
          <canvas id="networkCanvas" width="760" height="400"></canvas>
          <div class="q-gradient"><span id="qMin">min</span><div class="bar"></div><span id="qMax">max</span></div>
          <div class="net-legend" id="netLegend">Input dims: — | Actions: — | Color = relative Q (min→max)</div>
        </div>
      </div>
    </section>
    <!-- Reward Config Panel -->
    <section class="panel config-panel">
      <div class="panel-title">Reward Config</div>
      <form id="rewardConfigForm" class="config-simple">
        <label>1 line <input name="line_reward_1" type="number" step="0.01"/></label>
        <label>2 lines <input name="line_reward_2" type="number" step="0.01"/></label>
        <label>3 lines <input name="line_reward_3" type="number" step="0.01"/></label>
        <label>4 lines <input name="line_reward_4" type="number" step="0.01"/></label>
        <label>Survival <input name="survival_reward" type="number" step="0.001"/></label>
        <label>Top-out <input name="top_out_penalty" type="number" step="0.1"/></label>
        <div class="config-actions"><button type="submit">Apply</button><span id="configStatus" class="status"></span></div>
      </form>
      <div class="mini-help">Minimal scheme: reward per lines cleared, small survival reward, top-out penalty.</div>
    </section>
  </main>
  <div id="networkTooltip"></div>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="/static/main.js"></script>
</body>
</html>
